# Fantasy Sports PDF Aggregation & Lineup Optimization

This repository contains two main scripts that integrate **AI-generated player insights** and **linear optimization** techniques for building Daily Fantasy Sports (DFS) lineups. The first script (`pdf_aggregation.py`) processes PDF documents to extract mentions and desirability scores for DFS players. The second script (`lineup_optimization.py`) uses these scores, along with projected stats, to optimally build lineups under the typical DFS salary cap constraints.

## Table of Contents
1. [Overview](#overview)
2. [Features](#features)
3. [Prerequisites](#prerequisites)
4. [Installation](#installation)
5. [Usage](#usage)
   - [1. PDF Aggregation Script](#1-pdf-aggregation-script)
   - [2. Lineup Optimization Script](#2-lineup-optimization-script)
6. [File Structure](#file-structure)
7. [Disclaimer](#disclaimer)
8. [Contributing](#contributing)
9. [License](#license)

---

## Overview

1. **PDF Aggregation**: The code reads multiple PDF documents (e.g., scouting reports, sports analysis articles) and uses OpenAI APIs to pull out player-specific discussion and assign a DFS **desirability score**. This script creates a CSV with aggregated notes from each document, then consolidates them into a final summary per player.

2. **Lineup Optimization**: Uses the data from the PDF Aggregation (specifically the desirability scores) plus your standard DFS data (e.g., player salaries, projections) to build multiple DFS lineups. It leverages the [PuLP](https://coin-or.github.io/pulp/) library to maximize lineup projections under typical salary constraints.

---

## Features

- **Automated PDF Parsing**: Extracts relevant text from multiple PDFs without manual copying.
- **OpenAI Integration**: Enriches each player's data with AI-generated **desirability scores**.
- **CSV Generation & Consolidation**: Writes out thoroughly structured CSV files that capture partial and final data for each player.
- **Linear Optimization**: Uses the [PuLP](https://coin-or.github.io/pulp/) solver to generate up to 40 unique lineups that maximize projected points while respecting salary caps.
- **Easily Customizable**: Adjustable constraints, forced-player inputs, and more.

---

## Prerequisites

1. **Python 3.7+**  
   Make sure Python is installed and accessible via your command line.

2. **Libraries**:
   - `openai` (for calling OpenAI APIs)
   - `pandas`
   - `PyPDF2`
   - `pulp`
   - `re` (built-in Python library)
   - `csv` (built-in Python library)

3. **OpenAI API Key**  
   You need an OpenAI API key with appropriate permissions to use GPT models.

4. **PDF Files**  
   You must have the relevant PDFs stored in the designated file paths.

5. **Valid Excel/CSV files**  
   - **Player Names Excel** (must contain columns `Name`, `Pos`, `Team`, and optionally `DFS ID`).
   - **DFS Dataset CSV** (must contain columns `Name`, `Pos`, `Salary`, `SS Proj`; optional `Actual`).

---

## Installation

1. **Clone the Repository**:
   ```bash
   git clone https://github.com/YourUsername/your-repo-name.git
   cd your-repo-name
   ```

2. **Install Dependencies**:
   ```bash
   pip install openai pandas PyPDF2 pulp
   ```
   or use a requirements file if provided:
   ```bash
   pip install -r requirements.txt
   ```

3. **Set Up Environment Variables** (optional but recommended):
   ```bash
   export OPENAI_API_KEY="YOUR_OPENAI_API_KEY"
   ```
   If you prefer, you can hardcode the key in the script (as shown in the sample), but it’s safer to store it as an environment variable.

---

## Usage

### 1. PDF Aggregation Script

**File**: `pdf_aggregation.py` (or whichever name you assign)

1. **Update File Paths**  
   - In the script, replace:
     - `input_excel_file` path with the path to your Player Names Excel file.
     - `output_csv_file` path where you want the aggregated CSV to be saved.
     - `pdf_file_paths_phase1` and `pdf_file_paths_phase2` with your actual PDF file locations.

2. **Set Your OpenAI API Key**  
   - Replace `openai.api_key` with your key OR read it from an environment variable if you prefer.

3. **Run the Script**:
   ```bash
   python pdf_aggregation.py
   ```
   - This will generate a CSV (`player_output.csv` in the example) with desirability scores and consolidated notes from the PDF documents.

**How it Works**:
- **Phase 1** reads Documents 1–3, extracting mention-based notes and scores for each player, and writes them to CSV.
- **Phase 2** appends additional information from Documents 4–6, aggregates them with existing data, and then writes consolidated notes and final scores.

### 2. Lineup Optimization Script

**File**: `lineup_optimization.py` (or whichever name you assign)

1. **Update Directory Paths**:
   - `DATA_FOLDER`: Folder containing your DFS CSV file.
   - `OUTPUT_FOLDER`: Folder where you want the optimized lineups CSV to be saved.
   - `AI_BOOST_FILE`: Path to the CSV generated by the PDF aggregation script (e.g. `player_output.csv`).

2. **Prepare Your DFS CSV**:
   - Ensure columns `Name`, `Pos`, `Salary`, `SS Proj` exist.
   - If `Actual` is not there, the script will create it automatically with zeros.

3. **Optional: Forced Players**:
   - The script prompts you to input player names you absolutely want to include in each lineup. You can comma-separate them or leave blank.

4. **Run the Script**:
   ```bash
   python lineup_optimization.py
   ```
   - It will generate up to 40 unique lineups (unless constraints prevent it) and save them into `top_lineups_wide.csv` in your output folder.

**How it Works**:
- Creates a linear optimization model to maximize your projected points (`SS Proj`) within a 50,000 salary cap.
- Pulls **AI Boost** scores (average desirability from the PDF aggregation) to show an `AI Score` in your final output.
- Outputs lineups in a “wide” format, listing all 8 positions (slots) with name, salary, AI boost, and projections.

---

## File Structure

A typical file structure might look like this:

```
your-repo-name/
├── pdf_aggregation.py             # Script to parse PDFs and aggregate data
├── lineup_optimization.py         # Script to build lineups using PuLP
├── player_output.csv              # Generated CSV with AI-based scores (after running pdf_aggregation.py)
├── SaberFiles/                    # Folder containing DFS CSV (for lineup_optimization.py)
│   └── YourDFSData.csv
├── SaberOptOutput/                # Folder for the resulting lineups
│   └── top_lineups_wide.csv
├── requirements.txt               # (Optional) List of Python dependencies
└── README.md                      # This README file
```

---

## Disclaimer

- **OpenAI API Usage**: Make sure you follow all [OpenAI usage policies](https://openai.com/policies).
- **Experimental**: These scripts are provided as is, without guarantee. DFS lineup building is inherently risky and this code does not assure profit or optimal real-world performance.
- **Cost**: If you’re calling the OpenAI API, usage fees may apply. Track your usage via your OpenAI account.

---

## Contributing

Contributions, bug reports, and feature requests are welcome! Please open an issue or create a pull request explaining your changes.

1. **Fork** the project
2. **Create your feature branch** (`git checkout -b feature/my-feature`)
3. **Commit your changes** (`git commit -m 'Add some feature'`)
4. **Push to the branch** (`git push origin feature/my-feature`)
5. **Open a Pull Request**

---

## License

You may incorporate these scripts into your own projects. Refer to the `LICENSE` file for full details if provided, or assume standard [MIT License](https://opensource.org/licenses/MIT) unless otherwise noted.

---
